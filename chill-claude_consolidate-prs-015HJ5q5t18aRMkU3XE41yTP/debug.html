<!DOCTYPE html>
<html>
<head>
  <title>Debug Test</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #000; color: #0f0; }
    .log { margin: 5px 0; }
    .error { color: #f00; }
    .success { color: #0f0; }
    .warning { color: #ff0; }
  </style>
</head>
<body>
  <h1>Pin Choreography Debug Test</h1>
  <div id="logs"></div>

  <script type="module">
    const log = (msg, type = 'log') => {
      const div = document.createElement('div');
      div.className = `log ${type}`;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      document.getElementById('logs').appendChild(div);
      console.log(msg);
    };

    log('Starting debug test...', 'success');

    try {
      // Test GSAP
      if (window.gsap) {
        log('✓ GSAP loaded', 'success');
      } else {
        log('✗ GSAP not loaded', 'error');
      }

      // Test ScrollTrigger
      if (window.ScrollTrigger) {
        log('✓ ScrollTrigger loaded', 'success');
      } else {
        log('✗ ScrollTrigger not loaded', 'error');
      }

      // Test Lenis
      if (window.Lenis) {
        log('✓ Lenis loaded', 'success');
      } else {
        log('✗ Lenis not loaded', 'error');
      }

      // Test SplitType
      if (window.SplitType) {
        log('✓ SplitType loaded', 'success');
      } else {
        log('✗ SplitType not loaded', 'error');
      }

      // Wait for main app to load
      setTimeout(() => {
        if (window.PIN_CHOREOGRAPHY) {
          log('✓ PIN_CHOREOGRAPHY initialized', 'success');
          log(`  - pinnedElements: ${window.PIN_CHOREOGRAPHY.pinnedElements.size}`, 'log');
        } else {
          log('✗ PIN_CHOREOGRAPHY not initialized', 'error');
        }

        if (window.MORPH_ENGINE) {
          log('✓ MORPH_ENGINE initialized', 'success');
        } else {
          log('✗ MORPH_ENGINE not initialized', 'error');
        }

        // Check for scroll cards
        const scrollCards = document.querySelectorAll('.scroll-card');
        log(`Found ${scrollCards.length} scroll cards`, scrollCards.length > 0 ? 'success' : 'warning');

        // Check for immersion cards
        const immersionCards = document.querySelectorAll('.immersion-card');
        log(`Found ${immersionCards.length} immersion cards`, immersionCards.length > 0 ? 'success' : 'warning');

        // Check ScrollTrigger instances
        if (window.ScrollTrigger) {
          const triggers = window.ScrollTrigger.getAll();
          log(`ScrollTrigger instances: ${triggers.length}`, triggers.length > 0 ? 'success' : 'warning');

          triggers.forEach((trigger, i) => {
            const isPinned = trigger.vars.pin ? ' [PINNED]' : '';
            log(`  ${i + 1}. ${trigger.vars.trigger?.id || 'unknown'}${isPinned}`, 'log');
          });
        }

      }, 2000);

    } catch (error) {
      log(`ERROR: ${error.message}`, 'error');
      log(error.stack, 'error');
    }
  </script>

  <!-- Load dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
  <script src="https://unpkg.com/@studio-freight/lenis@1.0.29/dist/lenis.min.js"></script>
  <script src="https://unpkg.com/split-type@0.3.4/umd/index.js"></script>

  <!-- Load main app -->
  <script>
    // Create an iframe to load the actual page
    const iframe = document.createElement('iframe');
    iframe.src = '/index.html';
    iframe.style.display = 'none';
    document.body.appendChild(iframe);

    // Copy window references from iframe
    iframe.onload = () => {
      setTimeout(() => {
        if (iframe.contentWindow.PIN_CHOREOGRAPHY) {
          window.PIN_CHOREOGRAPHY = iframe.contentWindow.PIN_CHOREOGRAPHY;
        }
        if (iframe.contentWindow.MORPH_ENGINE) {
          window.MORPH_ENGINE = iframe.contentWindow.MORPH_ENGINE;
        }
        if (iframe.contentWindow.ScrollTrigger) {
          window.ScrollTrigger = iframe.contentWindow.ScrollTrigger;
        }
      }, 1000);
    };
  </script>
</body>
</html>
